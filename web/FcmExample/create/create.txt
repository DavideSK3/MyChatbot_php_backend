CREATE TABLE users (
  fbid varchar(100) NOT NULL PRIMARY KEY ,
  token text NOT NULL,
  name varchar(50) NOT NULL
);

CREATE TABLE friends (
	id varchar(100) NOT NULL,
	friendid varchar(100) NOT NULL,
	installed boolean DEFAULT TRUE,
	PRIMARY KEY(id, friendid),
	FOREIGN KEY(id) REFERENCES users(fbid),
	FOREIGN KEY(friendid) REFERENCES users(fbid)
);

CREATE TABLE chats (
	chatid int(11) NOT NULL,
	chatname varchar(50) NOT NULL,
	participant varchar(100) NOT NULL,
	time timestamp NOT NULL,
	PRIMARY KEY (chatid,participant),
	FOREIGN KEY(participant) REFERENCES users(fbid)
);

CREATE TABLE messages (
	chatid int(11) NOT NULL,
	sender varchar(100) NOT NULL,
	content text NOT NULL,
	ismedia boolean DEFAULT FALSE,
	time timestamp NOT NULL,
	PRIMARY KEY(chatid,sender,time)
	FOREIGN KEY(chatid,sender) REFERENCES chats(chatid,participant)
);
